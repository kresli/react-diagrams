(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[14],{2222:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return Ie},frontMatter:function(){return Ee},metadata:function(){return ge},toc:function(){return Ne}});var r,i,o,u=t(2122),a=t(9756),l=t(7294),c=t(3905),s=(0,l.createContext)([]),d=(0,l.createContext)([]),m=(0,l.createContext)(1),f=(0,l.createContext)([0,0]),p=(0,l.createContext)(null),v=(0,l.createContext)(null),E=(0,l.createContext)(null),g=function(){return(0,l.useContext)(E)},N=function(e,n,t){void 0===t&&(t=!1);var r=(0,l.useRef)(null);r.current=n;var i=(0,l.useCallback)((function(e){if(1===e.buttons){window.addEventListener("mousemove",(function e(n){n.preventDefault(),t&&n.stopImmediatePropagation(),n.buttons||window.removeEventListener("mousemove",e),r.current(n.movementX,n.movementY)}))}}),[t]);(0,l.useLayoutEffect)((function(){var n;null==(n=e.current)||n.addEventListener("mousedown",i)}),[i,e])};!function(e){e.FORWARD="FORWARD",e.BACKWARD="BACKWARD"}(r||(r={})),function(e){e.INPUT="INPUT",e.OUTPUT="OUTPUT"}(i||(i={})),function(e){e.CANVAS="CANVAS",e.LINK="LINK",e.NODE="NODE",e.PORT="PORT",e.VIEW="VIEW",e.GATE="GATE"}(o||(o={}));var k=t(4586);function I(e,n,t){var r=n.getBoundingClientRect(),i=r.left,o=r.top;return[(e[0]-i)/t,(e[1]-o)/t]}var O="diagramelement",R=O+"type",y=O+"id";function b(e){return e.dataset[R]}var L;!function(e){e.VIEWPORT_SET="VIEWPORT_SET",e.VIEWPORT_MOVE="VIEWPORT_MOVE",e.VIEWPORT_ZOOM="VIEWPORT_ZOOM",e.NODE_MOVE="NODE_MOVE",e.ADD_NODE="ADD_NODE",e.REMOVE_NODE="REMOVE_NODE",e.LINK_CREATE="LINK_CREATE",e.LINK_REMOVE="LINK_REMOVE",e.REGISTER_ELEMENT_TYPE="REGISTER_ELEMENT_TYPE",e.CREATE_DRAGGING_LINK="CREATE_DRAGGING_LINK",e.MOVE_DRAGGING_LINK="MOVE_DRAGGING_LINK",e.DELETE_DRAGGING_LINK="DELETE_DRAGGING_LINK"}(L||(L={}));var x=function e(n,t){switch(t.type){case L.VIEWPORT_MOVE:var r=t.movementX,i=t.movementY,u=n.position,a=[u[0]+r,u[1]+i];return Object.assign({},n,{position:a});case L.NODE_MOVE:var l=t.node,c=t.movementX,s=t.movementY,d=n.scale,m=l.position,f=m[0],p=m[1],v=n.nodes.map((function(e){return e.id===l.id?Object.assign({},e,{position:[f+c/d,p+s/d]}):e}));return Object.assign({},n,{nodes:v});case L.VIEWPORT_ZOOM:var E=t.deltaY,g=t.clientX,N=t.clientY,O=n.viewRef;if(!O)return n;var b=.1*n.scale,x=E<0?-b:b,h=n.scale+x;if(h<=.1)return n;var T=O.getBoundingClientRect(),w=T.left,_=T.top,C=w-n.position[0],D=_-n.position[1],M=[w-C-(g-w)*(x/n.scale),_-D-(N-_)*(x/n.scale)];return Object.assign({},n,{position:M,scale:h});case L.ADD_NODE:var P=Object.assign({id:(0,k.Z)(),position:[0,0]},t.node),A=[].concat(n.nodes,[P]);return Object.assign({},n,{nodes:A});case L.REMOVE_NODE:var G,V,S=n.nodes.filter((function(e){return e!==t.node})),K=[].concat((null==(G=t.node.inputs)?void 0:G.map((function(e){return e.id})))||[],(null==(V=t.node.outputs)?void 0:V.map((function(e){return e.id})))||[]),Z=n.links.filter((function(e){var n=e.input,t=e.output;return!(K.includes(n)||K.includes(t))}));return Object.assign({},n,{links:Z,nodes:S});case L.REGISTER_ELEMENT_TYPE:var j=t.element,Y=t.elementType,W=t.register,X=t.id,U=n.registeredElements;W?(U.set(j,{element:j,type:Y}),Ee=Y,j.setAttribute("data-"+R,Ee),X&&function(e,n){e.setAttribute("data-"+y,n)}(j,X)):U.delete(j);var F=o.CANVAS,z=o.VIEW,B=Y===F?j:n.canvasRef,q=Y===z?j:n.viewRef;return Object.assign({},n,{registeredElements:U,canvasRef:B,viewRef:q});case L.LINK_REMOVE:var H=n.links.filter((function(e){return e!==t.link}));return Object.assign({},n,{links:H});case L.LINK_CREATE:var Q=t.input,J={output:t.output,input:Q},$=[].concat(n.links,[J]);return Object.assign({},n,{links:$});case L.CREATE_DRAGGING_LINK:var ee=t.portId,ne=t.clientX,te=t.clientY;if(!n.viewRef)return n;if(n.dragLink){var re=n.nodes.find((function(e){var t=e.outputs;return null==t?void 0:t.find((function(e){return e.id===n.dragLink.portId}))})),ie=re?n.dragLink.portId:t.portId,oe=re?t.portId:n.dragLink.portId;return e(Object.assign({},n,{dragLink:null}),{type:L.LINK_CREATE,input:ie,output:oe})}var ue={start:I([ne,te],n.viewRef,n.scale),end:I([ne,te],n.viewRef,n.scale),portId:ee};return Object.assign({},n,{dragLink:ue});case L.MOVE_DRAGGING_LINK:if(!n.dragLink)return n;var ae=n.scale,le=t.movementX,ce=t.movementY,se=n.dragLink.end,de=se[0],me=se[1],fe=n.dragLink.start,pe=[de+le/ae,me+ce/ae],ve=Object.assign({},n.dragLink,{start:fe,end:pe});return Object.assign({},n,{dragLink:ve});case L.DELETE_DRAGGING_LINK:return Object.assign({},n,{dragLink:null});default:return n}var Ee};var h=function(e){!function(e){var n=e.nodes.map((function(e){return e.id}));if(new Set(n).size!==n.length)throw new Error("nodes id must be unique");var t=e.nodes.map((function(e){return[].concat(e.inputs||[],e.outputs||[])})).flat().map((function(e){return e.id}));if(new Set(t).size!==t.length)throw new Error("port id must be unique")}(e);var n=(0,l.useReducer)(x,e),t=n[0],r=t.links,i=t.nodes,u=t.position,a=t.scale,c=t.viewRef,s=t.dragLink,d=t.canvasRef,m=n[1],f=(0,l.useCallback)((function(e,n){if(!c)return[0,0];var t=c.getBoundingClientRect(),r=t.left,i=t.top;return[(e-r)/a,(n-i)/a]}),[a,c]),p=(0,l.useCallback)((function(e,n){return document.elementsFromPoint(e,n).map((function(e){return b(e)!==o.NODE?null:i.find((function(n){return n.id===function(e){return e.dataset[y]}(e)}))})).filter((function(e){return e}))}),[i]),v=function(e){m({type:L.ADD_NODE,node:e})},E=function(e){m({type:L.REMOVE_NODE,node:e})},g=(0,l.useCallback)((function(e,n){return document.elementsFromPoint(e,n).map((function(e){return b(e)})).filter((function(e){return e}))}),[]);return(0,l.useMemo)((function(){return{dispatchAction:m,elementsFromPoint:g,clientToLocalPosition:f,clientToNode:p,addNode:v,removeNode:E,dragLink:s,nodes:i,links:r,scale:a,position:u,view:c,canvas:d}}),[d,f,p,s,g,r,i,u,a,c])};function T(e,n,t){var r=g();(0,l.useLayoutEffect)((function(){var i=e.current;if(i){var o=L.REGISTER_ELEMENT_TYPE;return r({type:o,element:i,elementType:n,register:!0,id:t}),function(){return r({type:o,element:i,elementType:n,register:!1,id:t})}}}),[r,n,t,e])}var w,_,C,D,M,P=(0,l.memo)((function(e){var n=e.children,t=e.x,r=e.y;return l.createElement("div",{style:{background:"white",position:"fixed",left:t,top:r,zIndex:99999}},n)})),A=t(5761),G=t(9163),V=G.ZP.div(w||(w=(0,A.Z)(["\n  font-size: 14px;\n  font-weight: 400;\n  letter-spacing: 0;\n  line-height: 1.28581;\n  text-transform: none;\n  color: #182026;\n  font-family: -apple-system, BlinkMacSystemFont, Segoe UI, Roboto, Oxygen,\n    Ubuntu, Cantarell, Open Sans, Helvetica Neue, Icons16, sans-serif;\n  position: relative;\n  background: #1e1e1e;\n  width: 100%;\n  height: 100%;\n  overflow: hidden;\n"]))),S=(0,l.memo)((function(){var e=(0,l.useRef)(null),n=g();return T(e,o.CANVAS),N(e,(0,l.useCallback)((function(e,t){n({type:L.VIEWPORT_MOVE,movementX:e,movementY:t})}),[n])),function(e,n){var t=(0,l.useCallback)((function(e){return n(e)}),[n]);(0,l.useLayoutEffect)((function(){var n;null==(n=e.current)||n.addEventListener("wheel",t)}),[t,e])}(e,(0,l.useCallback)((function(e){e.stopImmediatePropagation(),e.preventDefault();var t=e.clientX,r=e.clientY,i=e.deltaY;n({type:L.VIEWPORT_ZOOM,clientX:t,clientY:r,deltaY:i})}),[n])),l.createElement(V,{className:"Diagram",ref:e},l.createElement(H,null))})),K={zIndex:{linksLayer:100,nodesLayer:200},node:{borderRadius:"4pt"}},Z=(0,l.memo)((function(e){var n=e.schema,t=n.canvas,r=function(){var e=(0,l.useState)(null),n=e[0],t=e[1],r=(0,l.useState)(null),i=r[0],o=r[1];(0,l.useEffect)((function(){if(n){var e=function(e){e.stopImmediatePropagation(),e.preventDefault(),o([e.clientX,e.clientY])},t=function(e){return o(null)};return window.addEventListener("click",t),n.addEventListener("contextmenu",e),function(){n.removeEventListener("contextmenu",e),window.removeEventListener("click",t)}}}),[n]);var u=(0,l.useMemo)((function(){return function(e){var n=e.children;return l.createElement(l.Fragment,null,i&&l.createElement(P,{x:i[0],y:i[1]},n))}}),[i]);return(0,l.useMemo)((function(){return{ContextMenu:u,setContextTrigger:t,contextPosition:i}}),[u,i])}(),i=r.ContextMenu,o=r.setContextTrigger,u=r.contextPosition,a=n.elementsFromPoint,c=(0,l.useMemo)((function(){if(!u)return null;var e=u[0],n=u[1];return a(e,n)}),[u,a]);return(0,l.useEffect)((function(){o(t)}),[t,o]),l.createElement(G.f6,{theme:K},l.createElement(ie,{schema:n},l.createElement(S,null)),l.createElement(i,null,l.createElement(se,{onAddNode:function(){if(u){var e=n.clientToLocalPosition.apply(n,u);n.addNode({position:e,inputs:[{id:(0,k.Z)()}],outputs:[{id:(0,k.Z)()}]})}},contextTypes:c,onRemoveNode:function(){if(u){var e=n.clientToNode.apply(n,u)[0];e&&n.removeNode(e)}}})))})),j=function(e){var n=e.port.id,t=(0,l.useRef)(null);return T(t,o.GATE,n),l.createElement("div",{ref:t,className:"Gate",style:{position:"absolute",width:0,height:0}})},Y=G.ZP.div(_||(_=(0,A.Z)(["\n  width: 12px;\n  height: 12px;\n  background: rgb(98, 98, 98);\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  position: absolute;\n  border-radius: 100%;\n  top: 4px;\n  left: ",";\n  right: ",";\n  &:hover {\n    background-color: red;\n  }\n"])),(function(e){return e.type===i.INPUT?"-26px":"auto"}),(function(e){return e.type===i.OUTPUT?"-26px":"auto"})),W=(0,l.memo)((function(e){var n=e.type,t=e.port;return l.createElement("div",{className:"InputOutput",style:{flex:1,display:"flex",position:"relative",minHeight:20,justifyContent:n===i.INPUT?"flex-start":"flex-end"}},l.createElement(de,{port:t},l.createElement(Y,{type:n},l.createElement(j,{port:t}))))})),X=G.ZP.div(C||(C=(0,A.Z)(["\n  background-color: #2d2d2d;\n  border-radius: 4pt;\n  &:hover {\n    box-shadow: 0 0 0px 2px #ffffff73;\n  }\n"]))),U=G.ZP.div(D||(D=(0,A.Z)(["\n  padding: 2pt;\n  color: rgba(255, 255, 255, 0.85);\n  height: 16pt;\n  width: 300px;\n  background-color: #4b4b4b;\n  display: flex;\n  justify-content: center;\n  border-top-left-radius: 4pt;\n  border-top-right-radius: 4pt;\n"]))),F=G.ZP.div(M||(M=(0,A.Z)(["\n  position: relative;\n  display: flex;\n  flex-direction: column;\n  padding: 8px;\n"]))),z=(0,l.memo)((function(e){var n=e.inputs,t=e.outputs;return l.createElement(X,null,l.createElement(U,null,"title"),l.createElement(F,{className:"io"},l.createElement("div",{className:"Inputs",style:{flex:1,display:"flex",flexDirection:"column"}},null==n?void 0:n.map((function(e){return l.createElement(W,{key:e.id,port:e,type:i.INPUT})}))),l.createElement("div",{className:"Outputs",style:{flex:1,display:"flex",flexDirection:"column"}},null==t?void 0:t.map((function(e){return l.createElement(W,{key:e.id,port:e,type:i.OUTPUT})})))))})),B=(0,l.memo)((function(){var e=(0,G.Fg)().zIndex,n=(0,l.useContext)(s),t=(0,l.useMemo)((function(){return n.map((function(e){return l.createElement(re,{key:e.id,node:e})}))}),[n]);return l.createElement("div",{className:"nodesLayer",style:{position:"absolute",zIndex:e.nodesLayer}},t)})),q=(0,l.memo)((function(){var e=(0,l.useContext)(d),n=(0,l.useContext)(v),t=(0,G.Fg)().zIndex,r=(0,l.useMemo)((function(){return e.map((function(e){var n=Array.isArray,t=e.input,r=e.output,i=""+(n(t)?"_":t)+(n(r)?"_":r);return l.createElement(ne,{key:i,link:e})}))}),[e]);return l.createElement("svg",{className:"LinksLayer",style:{position:"absolute",pointerEvents:"none",width:1,height:1,overflow:"overlay",zIndex:t.linksLayer}},r,n&&l.createElement(oe,null))})),H=(0,l.memo)((function(){var e=(0,l.useRef)(null),n=(0,l.useContext)(f),t=n[0],r=n[1],i=(0,l.useContext)(m),u=(0,l.useMemo)((function(){return{position:"absolute",transform:"scale("+i+")",transformOrigin:"top left",left:t,top:r}}),[t,r,i]);return T(e,o.VIEW),l.createElement("div",{className:"viewLayer",style:u,ref:e},l.createElement(B,null),l.createElement(q,null))})),Q=["render"],J={attributes:!0,attributeFilter:["style"]};function $(e){var n=(0,l.useContext)(p),t=(0,l.useState)(0),r=t[0],i=t[1],u=(0,l.useState)(0),a=u[0],c=u[1],s=(0,l.useContext)(m);return(0,l.useLayoutEffect)((function(){var t,r,u,a,l=(t=o.GATE,u="[data-"+R+'="'+t+'"]',a=(r=e)?"[data-"+y+'="'+r+'"]':"",document.querySelectorAll(""+u+a))[0];if(l){var d=function(){if(l&&n){var e=l.getBoundingClientRect(),t=e.left,r=e.top,o=n.getBoundingClientRect(),u=o.left,a=o.top,d=(t-u)/s,m=(r-a)/s;i(Math.round(d)),c(Math.round(m))}},m=new MutationObserver(d),f=function(e){var n=e.parentElement;for(;n;){if(!n)return null;if(b(n)===o.NODE)return n;n=n.parentElement}return null}(l);if(f)return m.observe(f,J),d(),function(){return m.disconnect()}}}),[e,s,n]),(0,l.useMemo)((function(){return[r,a]}),[r,a])}var ee,ne=(0,l.memo)((function(e){var n=e.link,t=g(),r=$(n.input),i=$(n.output),o=(0,l.useCallback)((function(){t({type:L.LINK_REMOVE,link:n})}),[t,n]),u=(0,l.useMemo)((function(){return n.render||te}),[n.render]),c=(0,l.useMemo)((function(){n.render;var e=(0,a.Z)(n,Q);return Object.assign({},e,{start:r,end:i})}),[i,n,r]);return l.createElement("g",{pointerEvents:"visible",onDoubleClick:o},l.createElement(u,{link:c}))}));var te=(0,l.memo)((0,G.ZP)((function(e){var n=e.link,t=e.className,r=n.start,i=n.end,o=(0,l.useMemo)((function(){var e=r[0],n=r[1],t=i[0],o=i[1];return"M"+e+" "+n+" H"+(e+30)+" L"+(t-30)+" "+o+" "+t+" "+o}),[i,r]);return l.createElement("path",{className:t,d:o})}))(ee||(ee=(0,A.Z)(["\n  stroke-width: 4;\n  stroke: rgb(98, 98, 98);\n  stroke-linecap: round;\n  fill: none;\n  &:hover {\n    stroke: rgb(255, 255, 255);\n  }\n"])))),re=(0,l.memo)((function(e){var n=e.node,t=g(),r=(0,l.useMemo)((function(){return Object.assign({render:z},n)}),[n]),i=r.position,a=r.id,c=r.inputs,s=r.outputs,d=r.data,m=i[0],f=i[1],p=(0,l.useRef)(null),v=r.render,E=(0,l.useMemo)((function(){return{inputs:null==c?void 0:c.map((function(e){return Object.assign({},e,{key:e.id})})),outputs:null==s?void 0:s.map((function(e){return Object.assign({},e,{key:e.id})})),data:d}}),[d,c,s]);return T(p,o.NODE,r.id),N(p,(0,l.useCallback)((function(e,n){t({type:L.NODE_MOVE,movementX:e,movementY:n,node:r})}),[t,r]),!0),l.createElement("div",{className:"DiagramNode",ref:p,style:{position:"absolute",left:m,top:f,cursor:"default"}},l.createElement(v,(0,u.Z)({key:a},E)))})),ie=function(e){var n=e.children,t=e.schema;return l.createElement(p.Provider,{value:t.view},l.createElement(E.Provider,{value:t.dispatchAction},l.createElement(s.Provider,{value:t.nodes},l.createElement(d.Provider,{value:t.links},l.createElement(m.Provider,{value:t.scale},l.createElement(f.Provider,{value:t.position},l.createElement(v.Provider,{value:t.dragLink},n)))))))},oe=(0,l.memo)((function(){var e=g(),n=(0,l.useContext)(v),t=(0,l.useMemo)((function(){if(n){var e=n.start,t=e[0],r=e[1],i=n.end;return"M"+t+" "+r+" "+i[0]+" "+i[1]}}),[n]);return(0,l.useEffect)((function(){var n=function(n){var t=n.movementX,r=n.movementY;n.stopImmediatePropagation(),e({type:L.MOVE_DRAGGING_LINK,movementX:t,movementY:r})},t=function(){e({type:L.DELETE_DRAGGING_LINK})};return window.addEventListener("mousemove",n),window.addEventListener("mousedown",t),function(){window.removeEventListener("mousemove",n),window.removeEventListener("mousedown",t)}}),[e]),l.createElement("path",{d:t,stroke:"white",fill:"none"})})),ue=function(e){var n=e.onAddNode;return l.createElement("div",null,l.createElement("button",{onClick:n},"create"))},ae=function(e){var n=e.onRemoveNode;return l.createElement("div",null,l.createElement("button",{onClick:n},"remove node"))},le=function(){return l.createElement("div",null,"link")},ce=function(){return l.createElement("div",null,"port")},se=(0,l.memo)((function(e){var n=e.onAddNode,t=e.contextTypes,r=e.onRemoveNode;if(!t)return null;switch(!0){case t[0]===o.CANVAS:return l.createElement(ue,{onAddNode:n});case t[0]===o.NODE:return l.createElement(ae,{onRemoveNode:r});case t.includes(o.PORT):return l.createElement(ce,null);case t[0]===o.LINK:return l.createElement(le,null)}return null})),de=(0,l.memo)((function(e){var n=e.port,t=e.children,r=e.style,i=n.id,u=g(),a=(0,l.useRef)(null);T(a,o.PORT,i),N(a,(0,l.useCallback)((function(){}),[]));var c=(0,l.useCallback)((function(e){var n=e.clientX,t=e.clientY;a.current&&u({type:L.CREATE_DRAGGING_LINK,clientX:n,clientY:t,portId:i})}),[u,i]);return(0,l.useLayoutEffect)((function(){var e;null==(e=a.current)||e.addEventListener("mousedown",(function(e){return e.stopImmediatePropagation()}))}),[]),l.createElement("div",{ref:a,onClick:c,style:r},t)})),me={dragLink:null,registeredElements:new Map,canvasRef:null,viewRef:null,nodes:[{id:"1",position:[100,100],outputs:[{id:"1"}]},{id:"3",position:[400,400],inputs:[{id:"3"}]}],links:[{input:"1",output:"3"}],position:[0,0],scale:1},fe=function(){var e=h(me);return l.createElement("div",{style:{width:"100%",height:500}},l.createElement(Z,{schema:e}))},pe=t(6589),ve=["components"],Ee={id:"Introduction",slug:"/"},ge={unversionedId:"Introduction",id:"Introduction",isDocsHomePage:!1,title:"Introduction",description:"Quick Example",source:"@site/docs/Introduction.mdx",sourceDirName:".",slug:"/",permalink:"/react-diagrams/",editUrl:"https://github.com/kresli/react-diagrams/edit/master/website/docs/Introduction.mdx",version:"current",frontMatter:{id:"Introduction",slug:"/"},sidebar:"ReactDiagrams",next:{title:"Installation",permalink:"/react-diagrams/Installation"}},Ne=[{value:"Quick Example",id:"quick-example",children:[]}],ke={toc:Ne};function Ie(e){var n=e.components,t=(0,a.Z)(e,ve);return(0,c.kt)("wrapper",(0,u.Z)({},ke,t,{components:n,mdxType:"MDXLayout"}),(0,c.kt)("h2",{id:"quick-example"},"Quick Example"),(0,c.kt)(pe.Z,{className:"language-tsx",mdxType:"CodeBlock"},'import { Schema, useSchema, Diagram } from "../../src";\nimport React from "react";\n\nconst initialSchema: Schema = {\n  dragLink: null,\n  registeredElements: new Map(),\n  canvasRef: null,\n  viewRef: null,\n  nodes: [\n    {\n      id: "1",\n      position: [100, 100] as [number, number],\n      outputs: [{ id: "1" }],\n    },\n    {\n      id: "3",\n      position: [400, 400] as [number, number],\n      inputs: [{ id: "3" }],\n    },\n  ],\n  links: [\n    {\n      input: "1",\n      output: "3",\n    },\n  ],\n  position: [0, 0] as [number, number],\n  scale: 1,\n};\n\nexport const Playground = () => {\n  const schema = useSchema(initialSchema);\n  return (\n    <div style={{ width: "100%", height: 500 }}>\n      <Diagram schema={schema} />\n    </div>\n  );\n};\n'),(0,c.kt)(fe,{mdxType:"Playground"}))}Ie.isMDXComponent=!0}}]);